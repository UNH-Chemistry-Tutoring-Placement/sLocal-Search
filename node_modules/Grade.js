/**
 * Created by jeep on 10/28/15.
 */
module.exports.grade = Grade;
module.exports.gradeWith = GradeWith;
module.exports.gradeWithout = GradeWithout;
module.exports.gradeTotal = GradeTotal;

var data = require('FileData').get();

function Grade(timeslot, studentsInTimeslot){
    var belowMin = data.objective.penalties.belowMin
    var aboveMax = data.objective.penalties.aboveMax
    var possChoice = data.objective.penalties.possibleChoice
    var impossChoice = 10
    var grade = 0
    if (timeslot.length < data.objective.min) grade = grade + belowMin
    if (timeslot.length > data.objective.max) grade = grade + aboveMax
    
    for (i = 0; i < studentsInTimeslot.length; i++) {
        var stud = data.student.students[studentsInTimeslot[i]];
        
        var isGood = false;
        for (j = 0; j < stud.numGoodTimes; j++) {
            var str = stud.goodTimes[j]
            if (str === timeslot) {
                isGood = true;
                break;
            }
        }
        
        if (isGood) continue;
        
        var isPossible = false;
        for (j = 0; j < stud.numPossibleTimes; j++) {
            var str = stud.possibleTimes[j]
            if (str === timeslot) {
                isPossible = true;
                grade = grade + possChoice;
                break;
            }
        }
        if (isPossible) continue;
        
        grade = grade + impossChoice;
        console.log("we had an impossible choice", "timeslot", timeslot, "student", stud);
    }
    return grade;
}

function GradeWithout(timeslot, studentsInTimeslot, removeStudent) {
    
    var studentIndex = studentsInTimeslot.indexOf(removeStudent);
    
    //remove the student
    studentsInTimeslot.splice(studentIndex, 1);
    
    //grade it
    var grade = Grade(timeslot, studentsInTimeslot);
    
    //add back the student
    studentsInTimeslot.splice(studentIndex, 0, removeStudent);
    
    return grade;
}

function GradeWith(timeslot, studentsInTimeslot, extraStudent) {
    
    //add the student to the end
    studentsInTimeslot.push(extraStudent);
    
    //grade
    var grade = Grade(timeslot, studentsInTimeslot);
    
    //remove student
    studentsInTimeslot.pop();
    
    return grade;
    
}

function GradeTotal(times){
    var total = 0;
    
    for (var time in times){
        total += Grade(time, times[time]);
    }
    
    return total;
}


