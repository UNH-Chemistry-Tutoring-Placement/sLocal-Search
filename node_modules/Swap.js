module.exports = Swap;

var grader = require('Grade'),
    rand = require('randomAssignment'),
    printOut = require('FileData').out;

function Swap(){
	
    
    var results = [],
        timeStart = new Date().getTime();
        timeUp = isNaN(Number(process.argv[2])) ? 1000 : Number(process.argv[2]) * 1000;
    
    
    while((new Date().getTime() - timeStart) < timeUp){
        var random = rand();

        //console.log("Beginning: ", grader.gradeTotal(random));

        //single swap until we go through and don't swap once
        do {
            var swapped = false;

            for (var time in random){

                //grade this time before any changes
                var beforePenalty1 = grader.grade(time, random[time]);

                for (var student of random[time]){

                    var afterPenalty1 = grader.gradeWithout(time, random[time], student);

                    //difference
                    var diff1 = beforePenalty1 - afterPenalty1;

                    for (var time2 in random){
                        if (time2 === time) continue; //ignore same time slot

                        var beforePenalty2 = grader.grade(time2, random[time2]);
                        var afterPenalty2 = grader.gradeWith(time2, random[time2], student);
                        var diff2 = beforePenalty2 - afterPenalty2;

                        var totalDiff = diff2 + diff1;

                        if (totalDiff > 0){
                            //swap
                            //console.log("Swapping ", student, "from", time, "to", time2);
                            swapped = true;
                            random[time].splice(random[time].indexOf(student), 1);
                            random[time2].push(student);
                            break;
                        }

                    }
                }
            }
        } while(swapped); 
    
        //idealy we'd do a double swap now but it looks like it's working pretty good
        var grade = grader.gradeTotal(random);
        if (typeof results[grade] === 'undefined')
            results[grade] = random;
        
    }
    
    for (var result in results){
        //best solution
        console.log("the score was", result, results[result]);
        printOut(results[result]);
    }


}


