module.exports.load = Load;
module.exports.get = Get;
module.exports.out = Out;

var fs = require('fs'),
	objectiveParser = require('objectiveParser'),
	classParser = require('classParser'),
	studentParser = require('studentParser'),
    Parser = require('Parser'),
    assignmentParser = require('assignmentParser');

var data = {};

function Load(cb){
    
    
    var _in = ""; //note that 'in' is a reserved keyword
    
    process.stdin.setEncoding('utf8');
    process.stdin.on('data', function(chunk){
        _in += chunk;
    });
    
    process.stdin.on('end', function(){
        
        var parser = new Parser(_in);
        
        for (var i = 0; i < 4; i ++){
        
            var line = parser.getLine();
            
            if (line.indexOf('Student Info Format') >= 0)
                data.student = studentParser(parser);
            else if (line.indexOf('Objective Function Format') >= 0)
                data.objective = objectiveParser(parser);
            else if (line.indexOf('Class Info Format') >= 0)
                data.class = classParser(parser);
            else if (line.indexOf('Solution Format') >= 0)
                data.assignment = assignmentParser(parser)
        
        }
        
        cb();
        
    });
    
}

function Get() { return data; }

function Out(grade, times){
    var out = "";
    
    out += "Solution Format: 2\n";
    out += "Objective Function: STUFF\n";
    out += "Class Info: STUFF\n";
    out += "Student Info: STUFF\n";
    out += "Number of students: " + data.student.numStudent + "\n";
    for (var time in times){
        for (var i = 0; i < times[time].length; i++){
            var studentEmail = times[time][i];
            out += "# ------------------------ \n";
            out += "# Student: " + data.student.students[studentEmail].name + "\n";
            out += data.student.students[studentEmail].email + "\n";
            out += time + "\n";
            out += "# TA Name: " + data.class.groups[time].name + "\n";
            out += data.class.groups[time].email + "\n";
        }
    }
    out += "Solution cost: " + grade;
    
    fs.writeFileSync(process.argv[3] || 'solution', out);
}

